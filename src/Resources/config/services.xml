<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://symfony.com/schema/dic/services https://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <!-- Standard Defaults -->
        <defaults autowire="true" autoconfigure="true" public="false"/>

        <!-- ScheduledTaskHandler automatisch als messenger.message_handler taggen -->
        <instanceof id="Shopware\Core\Framework\MessageQueue\ScheduledTask\ScheduledTaskHandler">
            <tag name="messenger.message_handler"/>
        </instanceof>

        <!-- Controller (öffentlich für Routing) -->
        <service id="Bow\Preishoheit\Controller\" public="true"/>

        <!-- Service Definitionen explizit -->
        <service id="Bow\Preishoheit\Service\PreishoheitApiService">
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="logger"/>
        </service>

        <service id="Bow\Preishoheit\Service\JobService">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
        </service>

        <service id="Bow\Preishoheit\Service\ResultMappingService">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="service" id="service_container"/>
        </service>

        <service id="Bow\Preishoheit\Service\MappingService">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
        </service>

        <!-- Scheduled Tasks -->
        <service id="Bow\Preishoheit\ScheduledTask\CheckPreishoheitJobStatusTaskHandler">
            <argument type="service" id="Bow\Preishoheit\Service\JobService"/>
            <argument type="service" id="Bow\Preishoheit\Service\PreishoheitApiService"/>
            <argument type="service" id="Bow\Preishoheit\Service\ResultMappingService"/>
            <tag name="messenger.message_handler"/>
        </service>

        <!-- DAL Entity Definitions -->
        <service id="Bow\Preishoheit\Entity\Job\JobDefinition">
            <tag name="shopware.entity.definition" entity="bow_preishoheit_job"/>
        </service>

        <service id="Bow\Preishoheit\Entity\JobResult\JobResultDefinition">
            <tag name="shopware.entity.definition" entity="bow_preishoheit_job_result"/>
        </service>

        <service id="Bow\Preishoheit\Entity\ProductMapping\ProductMappingDefinition">
            <tag name="shopware.entity.definition" entity="bow_preishoheit_product_mapping"/>
        </service>
        <!-- Entity Collections -->
        <service id="Bow\Preishoheit\Entity\Job\JobCollection"/>
        <service id="Bow\Preishoheit\Entity\JobResult\JobResultCollection"/>
        <service id="Bow\Preishoheit\Entity\ProductMapping\ProductMappingCollection"/>

    </services>
</container>
